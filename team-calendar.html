<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>ÊéíÂÅáÁ≥ªÁµ± LocalÁâà</title>
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  
  <style>
    :root {
      --ios-blue: #007AFF;
      --bg-color: #F2F2F7;
    }

    body {
      background: var(--bg-color);
      font-family: -apple-system, system-ui, sans-serif;
      margin: 0;
      padding-bottom: 120px;
      user-select: none;
      -webkit-user-select: none;
    }

    /* È†ÇÈÉ®Â∞éËà™ - ÁßªÈô§ËøîÂõûÈçµÂæåÈáçÊñ∞ÈÖçÁΩÆ */
    .app-header {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-bottom: 0.5px solid #d1d1d6;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .calendar-section { padding: 12px; }

    .month-header {
      font-size: 22px;
      font-weight: 700;
      margin: 20px 0 10px 8px;
      color: #000;
    }

    .calendar-card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      overflow: hidden;
      margin-bottom: 30px;
    }

    table { table-layout: fixed; width: 100%; border-collapse: collapse; }
    th { font-size: 12px; color: #8e8e93; padding: 12px 0; text-align: center; }
    
    td {
      height: 90px;
      border: 0.5px solid #f2f2f7;
      vertical-align: top;
      padding: 5px;
      position: relative;
    }

    td:active { background: #E5E5EA; }

    .today-highlight {
      background-color: #FFF9C4 !important;
      outline: 2px solid var(--ios-blue);
      z-index: 1;
    }

    .day-label {
      font-size: 14px;
      font-weight: 600;
      display: block;
      text-align: center;
      margin-bottom: 4px;
    }

    .tag {
      font-size: 10px;
      font-weight: bold;
      padding: 2px 4px;
      margin: 1px 0;
      border-radius: 4px;
      color: white;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
    }

    .bottom-bar {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.94);
      backdrop-filter: blur(20px);
      border-top: 0.5px solid #d1d1d6;
      padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
      display: flex;
      justify-content: space-around;
      z-index: 1001;
    }

    .person-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      opacity: 0.3;
      transition: all 0.2s;
    }

    .person-item.active { opacity: 1; transform: translateY(-3px); }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 4px;
    }

    #todayBtn {
      position: fixed;
      right: 20px;
      bottom: 110px;
      width: 52px;
      height: 52px;
      border-radius: 26px;
      background: var(--ios-blue);
      color: white;
      border: none;
      box-shadow: 0 4px 12px rgba(0,122,255,0.4);
      z-index: 999;
    }
  </style>
</head>
<body>

  <header class="app-header">
    <div style="font-weight: 800; font-size: 1.2rem;">üìÖ ÊéíÂÅáË°®</div>
    <select id="monthJump" class="form-select form-select-sm" style="width: auto; background: #efeff4; border: none; border-radius: 10px;"></select>
  </header>

  <div id="calendar-root" class="calendar-section"></div>

  <div class="bottom-bar" id="peopleSelector"></div>

  <button id="todayBtn"><i class="bi bi-cursor-fill"></i></button>

  <script>
    const years = [2025, 2026];
    const monthNames = ["‰∏ÄÊúà", "‰∫åÊúà", "‰∏âÊúà", "ÂõõÊúà", "‰∫îÊúà", "ÂÖ≠Êúà", "‰∏ÉÊúà", "ÂÖ´Êúà", "‰πùÊúà", "ÂçÅÊúà", "ÂçÅ‰∏ÄÊúà", "ÂçÅ‰∫åÊúà"];
    const people = [
      { name: "JARED", color: "#FF3B30" },
      { name: "RAYAN", color: "#007AFF" },
      { name: "ALAN", color: "#34C759" },
      { name: "LEO", color: "#FF9500" },
      { name: "JOSH", color: "#AF52DE" }
    ];

    let currentPerson = people[0].name;
    let calendarData = JSON.parse(localStorage.getItem('my_calendar_data')) || {};

    function saveToLocal() {
      localStorage.setItem('my_calendar_data', JSON.stringify(calendarData));
    }

    // Ê∏≤ÊüìÈÅ∏ÊìáÂô®
    const selector = document.getElementById('peopleSelector');
    people.forEach(p => {
      const div = document.createElement('div');
      div.className = `person-item ${p.name === currentPerson ? 'active' : ''}`;
      div.id = `p-${p.name}`;
      div.onclick = () => {
        currentPerson = p.name;
        document.querySelectorAll('.person-item').forEach(el => el.classList.remove('active'));
        div.classList.add('active');
        if (window.navigator.vibrate) window.navigator.vibrate(10);
      };
      div.innerHTML = `
        <div class="avatar" style="background:${p.color}">${p.name[0]}</div>
        <div style="font-size:10px; font-weight:600;">${p.name}</div>
      `;
      selector.appendChild(div);
    });

    // Ê∏≤ÊüìÊúà‰ªΩË∑≥ËΩâ
    const jump = document.getElementById('monthJump');
    years.forEach(y => {
      monthNames.forEach((m, i) => {
        const opt = document.createElement('option');
        opt.value = `cal-${y}-${i+1}`;
        opt.textContent = `${y} ${m}`;
        jump.appendChild(opt);
      });
    });
    jump.onchange = (e) => {
      const target = document.getElementById(e.target.value);
      if (target) window.scrollTo({ top: target.offsetTop - 80, behavior: 'smooth' });
    };

    // Ê†∏ÂøÉÊ∏≤Êüì
    function renderApp() {
      const root = document.getElementById('calendar-root');
      const now = new Date();
      root.innerHTML = '';

      years.forEach(year => {
        for (let month = 0; month < 12; month++) {
          const monthId = `cal-${year}-${month+1}`;
          const header = document.createElement('div');
          header.className = 'month-header';
          header.id = monthId;
          header.textContent = `${year}Âπ¥ ${monthNames[month]}`;
          root.appendChild(header);

          const card = document.createElement('div');
          card.className = 'calendar-card';
          
          let tableHtml = `<table><thead><tr><th>‰∏Ä</th><th>‰∫å</th><th>‰∏â</th><th>Âõõ</th><th>‰∫î</th><th>ÂÖ≠</th><th>Êó•</th></tr></thead><tbody><tr>`;
          let firstDay = new Date(year, month, 1).getDay();
          if (firstDay === 0) firstDay = 7;
          for (let i = 1; i < firstDay; i++) tableHtml += `<td></td>`;

          const daysInMonth = new Date(year, month + 1, 0).getDate();
          for (let day = 1; day <= daysInMonth; day++) {
            const key = `${year}-${month+1}-${day}`;
            const tags = calendarData[key] || [];
            const isToday = now.getFullYear() === year && now.getMonth() === month && now.getDate() === day;
            
            let tagsHtml = `<div id="tags-${key}">`;
            tags.forEach(pName => {
              const pObj = people.find(x => x.name === pName);
              if(pObj) tagsHtml += `<div class="tag" style="background:${pObj.color}">${pName}</div>`;
            });
            tagsHtml += `</div>`;

            tableHtml += `<td onclick="toggleDate('${key}')" class="${isToday ? 'today-highlight' : ''}">
              <span class="day-label">${day}</span>
              ${tagsHtml}
            </td>`;
            if ((firstDay + day - 1) % 7 === 0) tableHtml += `</tr><tr>`;
          }
          tableHtml += `</tr></tbody></table>`;
          card.innerHTML = tableHtml;
          root.appendChild(card);
        }
      });
    }

    window.toggleDate = function(key) {
      if (!calendarData[key]) calendarData[key] = [];
      const idx = calendarData[key].indexOf(currentPerson);
      if (idx >= 0) calendarData[key].splice(idx, 1);
      else calendarData[key].push(currentPerson);
      saveToLocal();
      updateCell(key);
    };

    function updateCell(key) {
      const container = document.getElementById(`tags-${key}`);
      const tags = calendarData[key] || [];
      let html = '';
      tags.forEach(pName => {
        const pObj = people.find(x => x.name === pName);
        if(pObj) html += `<div class="tag" style="background:${pObj.color}">${pName}</div>`;
      });
      container.innerHTML = html;
    }

    function scrollToCurrentMonth(isSmooth = false) {
      const now = new Date();
      const targetId = `cal-${now.getFullYear()}-${now.getMonth()+1}`;
      const target = document.getElementById(targetId);
      if (target) {
        document.getElementById('monthJump').value = targetId;
        window.scrollTo({ top: target.offsetTop - 80, behavior: isSmooth ? 'smooth' : 'auto' });
      }
    }

    document.getElementById('todayBtn').onclick = () => scrollToCurrentMonth(true);

    renderApp();
    setTimeout(() => scrollToCurrentMonth(false), 200);
  </script>
</body>
</html>
